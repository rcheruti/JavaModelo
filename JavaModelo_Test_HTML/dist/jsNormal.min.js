!function(a){var b=angular.module("JavaModelo",["ng","ui.router"]),c="persistencia/context",d=null,e=null;b.run([function(){if(!d.ativo){var b=c,f=new XMLHttpRequest;f.onreadystatechange=function(){4===f.readyState&&200===f.status&&(a.contextRoot=f.responseText)},f.open("GET",b,!1),f.send(),e.root(a.contextRoot)}}]),b.config(["$httpProvider","contextProvider","HostInterProvider",function(a,b,c){e=b,d=c,a.interceptors.push("LoginInter"),a.interceptors.push("HostInter"),a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),b.directive("segGrupo",["Usuario",function(a){return{link:function(b,c,d){a.then(function(a){if(a&&a.credencial&&a.credencial.grupos){var b={};for(var e in a.credencial.grupos){var f=a.credencial.grupos[e],g=f.chave.trim();b[g]||(b[g]=f)}var h=d.segGrupo.trim();0===h.indexOf("!")?b[h.substring(1,h.length)]&&c.remove():b[h]||c.remove()}})}}}]),b.directive("segPermissao",["Usuario",function(a){return{link:function(b,c,d){a.then(function(a){if(a&&a.credencial&&a.credencial.grupos){var b={};for(var e in a.credencial.grupos){var f=a.credencial.grupos[e];if(f.permissoes)for(var g in f.permissoes){var h=f.permissoes[g],i=h.nome.trim();b[i]||(b[i]=h)}}for(var g in a.credencial.permissoes){var h=a.credencial.permissoes[g],i=h.nome.trim();b[i]||(b[i]=h)}var j=d.segPermissao.trim();0===j.indexOf("!")?b[j.substring(1,j.length)]&&c.remove():b[j]||c.remove()}})}}}]),function(){function a(a,b){if(!b)return a;"string"==typeof b&&(b=b.split("."));for(var c=0;c<b.length;c++)a=a[b[c]]||(a[b[c]]={});return a}function c(a,b){a.$scope&&!a.$scope.$$phase?a.$scope.$apply():b&&b.$apply&&!b.$$phase&&b.$apply()}function d(a,b){b||(b={}),this.nome=a,this.dataPath=b.dataPath||r.dataPath,this.size=b.size||r.size,this.page=b.page||r.page,this.url=b.url||r.url,this.cache={},this.ultimoCache={},this.cacheTimeout=angular.extend({},r.cacheTimeout,b.cacheTimeout)}function e(a){this.entidade=a||{},this._size=this.entidade.size,this._page=this.entidade.page,this._where=[],this._join=[],this._order=[],this._data=null,this._id=!1,this._acao=1,this._url=this.entidade.url,this.$scope=null,this._build=null,this._cache=!1,this._clearCache=!1,this._inObj=null,this._inPath=this.entidade.nome}function f(b){if(this._cache&&(this.entidade.ultimoCache[this._acao]=Date.now(),this.entidade.cache[this._acao]=b),this._inObj){var d=this._inPath.split("."),e=a(this._inObj,d.slice(0,d.length-1));d=d[d.length-1],e[d]=a(b,this.entidade.dataPath),c(this,this._inObj)}return b}function g(a,b,c){a[b]=function(a){return this.data(a||this._data).acao(c).build().send()}}function h(a,b,c){a[b]=function(a,b,d){return this["in"](a,b)[c](d)}}function i(a,b,c,d){"undefined"!=typeof d?a[b]=function(a){return"undefined"==typeof a&&(a=d),this[c]=a,this}:a[b]=function(a){return this[c]=a,this}}function j(a){var b=a||[];b instanceof Array||(b=[b]),this._querys=b}function l(a,b){var c=!0;a instanceof Array||(a=[a],c=!1);for(var d=[],e=0;e<b.length;e++){var f=b[e];"number"==typeof f?d.push([f]):d.push(f.split("."))}for(var g,h,i,j,k,l,m=[],n=0;n<a.length;n++){h=a[n],g={},m.push(g);for(var e=0;e<d.length;e++){for(k=d[e],i=h,j=g,l=0;l<k.length-1;l++)i=i[k[l]],j[k[l]]||(j[k[l]]={}),j=j[k[l]];j[k[l]]=i[k[l]]}}return c?m:g}function m(a,b){var c=!0;a instanceof Array||(a=[a],c=!1);for(var d=[],e=0;e<b.length;e++){var f=b[e];"number"==typeof f?d.push([f]):d.push(f.split("."))}for(var g,h={},e=0;e<d.length;e++){var i=d[e];for(g=h,k=0;k<i.length-1;k++)g=g[i[k]];g[i[k]]=!0}for(var j=[],l=0;l<a.length;l++)j.push(n({},a[l],h));return c?j:j[0]}function n(a,b,c){for(var d in b)c[d]||(a[d]=b[d])}var o=null,p=null,q=null,r={contentType:"application/json",dataPath:"data.0",size:20,page:0,url:"/persistencia",cacheTimeout:{5:-1,1:18e4,2:18e4,3:18e4,4:18e4}},s={"Content-Type":r.contentType,"X-Requested-With":"XMLHttpRequest"},t={},u=e.prototype;i(u,"page","_page"),i(u,"size","_size"),i(u,"id","_id",!0),i(u,"data","_data"),i(u,"acao","_acao"),u.order=function(a){if(a instanceof Array)for(var b in a){var c=a[b];"string"==typeof c&&this._order.push(c)}else"string"==typeof a&&this._order.push(a);return this},u.join=function(a){if(a instanceof Array)for(var b in a){var c=a[b];"string"==typeof c&&this._join.push(c)}else"string"==typeof a&&this._join.push(a);return this},u.where=function(a,b,c,d,e){return a&&b?(b=b.toLowerCase(),"isnull"!==b&&"isnotnull"!==b||(c="-",e=!0),d?"&"!==d&&"|"!==d&&(d="|"):d="&","undefined"==typeof e?(c=""+c,0!==c.indexOf('"')&&0!==c.indexOf("'")&&(c='"'+c),c.lastIndexOf('"')!==c.length-1&&c.lastIndexOf("'")!==c.length-1&&(c+='"')):e&&(c='"'+c+'"'),this._where.push(a+" "+b+" "+c+d),this):this},u["in"]=function(a,b){return this._inObj=a,this._inPath=b,this},u.build=function(a){if(this._build&&!a)return this;var b="";for(var c in this._where)b+=this._where[c];return b=b.replace(/[&\|\s]+$/,""),this._build={entidade:this.entidade.nome,page:this._page,size:this._size,where:b,join:this._join,order:this._order,data:this._data,id:this._id,acao:this._acao},this},u.send=function(){var a=this.getCache();if(a)return p.resolve(f.call(b,a));var b=this;return o({method:"POST",url:this._url,headers:s,data:this._build}).then(function(a){return f.call(b,a.data)})},u.getCache=function(){var a=this.entidade,b=a.cache,c=this._acao;return this._clearCache||a.ultimoCache[c]&&a.cacheTimeout[c]>0&&Date.now()-a.ultimoCache[c]>a.cacheTimeout[c]?b[c]=null:b[c]?b[c]:void 0},u.clearBuild=function(){return this._build=!1,this},i(u,"cache","_cache",!0),i(u,"clearCache","_clearCache",!0),i(u,"apply","_apply"),g(u,"tipo",5),g(u,"get",1),g(u,"post",2),g(u,"put",3),g(u,"delete",4),g(u,"paginacao",10),h(u,"tipoIn","tipo"),h(u,"getIn","get"),h(u,"postIn","post"),h(u,"putIn","put"),h(u,"deleteIn","delete"),h(u,"paginacaoIn","paginacao");var v=j.prototype;v.add=function(a){return this._querys.push(a),this},v.remove=function(a){for(var b=0;b<this._querys.length;b++)if(this._querys[b]===a){this._querys.splice(b,1);break}return this},v.send=function(){if(!this._querys.length)return p(function(a,b){});for(var a=[],b=[],c=0;c<this._querys.length;c++){var d=this._querys[c];d.build();var e=d.getCache();e?b[c]=e:a.push(d._build)}if(a.length){var g=this;return o({method:"POST",url:r.url,headers:s,data:a}).then(function(a){a=a.data;var c=a.data;for(var d in b)c.splice(d,0,b[d].data);for(var d in c){var e=b[d];if(!e){var e={};for(var h in a)e[h]=a[h];e.data=[c[d]],e.size=g._querys[d]._size,e.page=g._querys[d]._page}f.call(g._querys[d],e)}return a})}},b.provider("Entidades",[function(){this.defaults=r;var a=this;this.$get=["context","$http","$q",function(b,c,f){o=c,p=f,a.defaults.url=b.root+a.defaults.url;var g={query:function(a){return"string"==typeof a&&(a=g.entidade(a)),new e(a)},queryMuitos:function(a){return new j(a)},entidade:function(b,c,e){var f=t[b];return f&&!e?f:(c||(c={}),c.url||(c.url=r.url),f=new d(b,c),a[b]=t[b]=f,f)},get:function(a){return t[a]},copiarCom:l,copiarSem:m};return g.eq=g.equal="=",g.ne=g.notEqual="!=",g.le=g.lowerThanOrEqualTo="<=",g.ge=g.greaterThanOrEqualTo=">=",g.lt=g.lowerThan="<",g.gt=g.greaterThan=">",g.nl=g.notLike="notlike",g.lk=g.like="like",g.nl=g.isNull="isnull",g.nnl=g.isNotNull="isnotnull",g.BUSCAR=1,g.CRIAR=2,g.EDITAR=3,g.DELETAR=4,g.TIPO=5,g.ADICIONAR=6,g.REMOVER=7,g.PAGINACAO=10,q=g}]}])}(),b.filter("",["Usuario",function(a){var b={};return a.then(function(a){if(a&&a.credencial&&a.credencial.grupos)for(var c in a.credencial.grupos){var d=a.credencial.grupos[c],e=d.chave.trim();b[e]||(b[e]=d)}}),function(a){return!!b[a]}}]),b.filter("hasPermissao",["Usuario",function(a){var b={};return a.then(function(a){if(a&&a.credencial&&a.credencial.grupos){for(var c in a.credencial.grupos){var d=a.credencial.grupos[c];if(d.permissoes)for(var e in d.permissoes){var f=d.permissoes[e],g=f.nome.trim();b[g]||(b[g]=f)}}for(var e in a.credencial.permissoes){var f=a.credencial.permissoes[e],g=f.nome.trim();b[g]||(b[g]=f)}}}),function(a){return!!b[a]}}]),b.provider("HostInter",[function(){var a=this;a.ativo=!1,a.url="",a.$get=["context",function(b){var c={request:function(b){return a.ativo&&(b.url=(a.url+b.url).replace(/\/+/g,"/")),b}};return c}]}]),b.provider("LoginInter",[function(a){var b=this;b.handler=null,b.state="",b.url="/login.html",b.ativo=!0,b.ERRORCODE_LOGIN=401,b.$get=["context","$window",function(a,c){var d={response:function(d){var e=d.data||{};if(b.ativo&&e.codigo===b.ERRORCODE_LOGIN)if(b.handler)b.handler(d);else if(b.state,1){var f=c.location.origin;c.location=f+a.root+b.url}else;return d}};return d}]}]),function(){var a,c,d=angular.injector(["ng"],!0),e=d.get("$q"),f=null,g=e(function(b,d){a=b,c=d});g._recarregar=!1,g.recarregar=function(){return g};var h=g.then;g.then=function(){g.$$state.status||g._recarregar||g.recarregar(),h.apply(g,arguments)},b.provider("Usuario",function(){f=this,this.carregarAoIniciar=!1,this.$get=function(){return g}}),b.run(["context","$http",function(b,d){g.recarregar=function(){return g._recarregar?g:(g.$$state.status=0,g._recarregar=!0,d.get(b.services+"/seguranca/usuario").then(function(b){200===b.data.codigo&&b.data.data?a(b.data.data):c({})},function(a){c(a)})["finally"](function(){g._recarregar=!1}),g)},f.carregarAoIniciar&&g.recarregar()}])}(),b.provider("context",[function(){function a(a,c,d){if(!a)return"";if("string"!=typeof a)throw"To configure the context url string you must pass a string as the first parameter value.";return"undefined"==typeof c&&(c=!0),a=a.trim(),c?0!==a.indexOf("/")&&(a="/"+a):0===a.indexOf("/")&&(a=a.substring(1,a.length)),d?a.lastIndexOf("/")!==a.length-1&&(a+="/"):a.lastIndexOf("/")===a.length-1&&(a=a.substring(0,a.length-1)),b(a)}function b(a){return a=a.trim().replace(/\/\/+/g,"/"),c.context.root||(a=a.replace(/^\s*\//,"")),a}var c=this,d={root:function(){return c.context.root="x",c.context.root=a.apply(this,arguments),c.context.services=b(c.context.root+c.context.path.services),c.context.websocket=b(c.context.root+c.context.path.websocket),c},services:function(){return c.context.services=b(c.context.root+(c.context.path.services=a.apply(this,arguments))),c},websocket:function(){return c.context.websocket=b(c.context.root+(c.context.path.websocket=a.apply(this,arguments))),c},put:function(b){return c.context[b]=a.call(this,arguments[1],arguments[2],arguments[3]),c},context:{root:"",path:{}}};angular.extend(this,d),this.$get=[function(){return c.context}]}])}(window);