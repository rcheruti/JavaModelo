!function(a){var b=angular.module("JavaModelo",["ng","ui.router"]);b.config(["$httpProvider",function(a){a.interceptors.push("LoginInter"),a.interceptors.push("HostInter"),a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),b.directive("segGrupo",["Usuario",function(a){return{link:function(b,c,d){a.then(function(a){if(a&&a.credencial&&a.credencial.grupos){var b={};for(var e in a.credencial.grupos){var f=a.credencial.grupos[e],g=f.chave.trim();b[g]||(b[g]=f)}var h=d.segGrupo.trim();0===h.indexOf("!")?b[h.substring(1,h.length)]&&c.remove():b[h]||c.remove()}})}}}]),b.directive("segPermissao",["Usuario",function(a){return{link:function(b,c,d){a.then(function(a){if(a&&a.credencial&&a.credencial.grupos){var b={};for(var e in a.credencial.grupos){var f=a.credencial.grupos[e];if(f.permissoes)for(var g in f.permissoes){var h=f.permissoes[g],i=h.nome.trim();b[i]||(b[i]=h)}}for(var g in a.credencial.permissoes){var h=a.credencial.permissoes[g],i=h.nome.trim();b[i]||(b[i]=h)}var j=d.segPermissao.trim();0===j.indexOf("!")?b[j.substring(1,j.length)]&&c.remove():b[j]||c.remove()}})}}}]),function(){function a(a,b){if(!b)return a;"string"==typeof b&&(b=b.split("."));for(var c=0;c<b.length;c++)a=a[b[c]]||(a[b[c]]={});return a}function c(a,b){a.$scope&&!a.$scope.$$phase?a.$scope.$apply():b&&b.$apply&&!b.$$phase&&b.$apply()}function d(a,b){b||(b={}),this.nome=a,this.dataPath=b.dataPath||m.dataPath,this.size=b.size||m.size,this.page=b.page||m.page,this.url=b.url||m.url,this.cache={},this.ultimoCache={},this.cacheTimeout=angular.extend({},m.cacheTimeout,b.cacheTimeout)}function e(a){this.entidade=a||{},this._size=this.entidade.size,this._page=this.entidade.page,this._param=[],this._join=[],this._order=[],this._data=null,this._url=this.entidade.url,this._method="",this.$scope=null,this._build=!1,this._path="",this._cache=!1,this._clearCache=!1,this._buscarUm=!0,this._buscarMuitos=!1,this._buscarId=!1}function f(a,b,c,d){a[b]=function(a){return this.path(d).data(a).method(c).build().send()}}function g(b,d,e){b[d]=function(b,d,f){d||(d=this.entidade.nome),d=d.split(".");var g=a(b,d.slice(0,d.length-1));d=d[d.length-1];var h=this;return this[e](f).then(function(a){return g[d]=a,c(h,b),a})}}function h(a,b,c,d){"undefined"!=typeof d?a[b]=function(a){return"undefined"==typeof a&&(a=d),this[c]=a,this}:a[b]=function(a){return this[c]=a,this}}function i(){this._querys=[],this._method="",this.$scope=null,this._build=!1,this._path="",this._buscarId=!1}var j=angular.injector(["ng"],!0),k=j.get("$http"),l=j.get("$q"),m={contentType:"application/json",dataPath:"data.data",size:20,page:0,url:"/persistencia",cacheTimeout:{"POST/tipo":-1,"POST/buscar":18e4,POST:18e4,PUT:18e4,DELETE:18e4}},n={"Content-Type":m.contentType},o={},p=e.prototype;h(p,"page","_page"),h(p,"size","_size"),p.order=function(a){if(a instanceof Array)for(var b in a){var c=a[b];"string"==typeof c&&this._order.push(c)}else"string"==typeof a&&this._order.push(a);return this},p.join=function(a){if(a instanceof Array)for(var b in a){var c=a[b];"string"==typeof c&&this._join.push(c)}else"string"==typeof a&&this._join.push(a);return this},p.param=function(a,b,c,d,e){return a?(d?"&"!==d&&"|"!==d&&(d="|"):d="&",void 0===e?(c=""+c,0!==c.indexOf('"')&&0!==c.indexOf("'")&&(c='"'+c),c.lastIndexOf('"')!==c.length-1&&c.lastIndexOf("'")!==c.length-1&&(c+='"')):e&&(c='"'+c+'"'),this._param.push(a+" "+b+" "+c+d),this):null},p.build=function(a){if(this._build&&!a)return this;var b="";for(var c in this._param)b+=this._param[c];b=b.replace(/[&\|\s]+$/,""),b&&(b="?"+b);var d=["size="+this._size,"page="+this._page];this._join.length>0&&d.push("join="+this._join.join(",")),this._order.length>0&&d.push("order="+this._order.join(",")),d=d.join(";"),d&&(d=";"+d),this._path||(this._path="");var e=""+(this._buscarUm?"/um":this._buscarMuitos?"/muitos":"")+(this._buscarId?"/id":"");return e=this._url+e+(this._buscarMuitos?"":"/"+this.entidade.nome)+this._path,this._url=e+d+b,this._build=!0,this},p.send=function(){var b=this.entidade,c=b.cache,d=this._method+this._path;if(this._clearCache||b.ultimoCache[d]&&b.cacheTimeout[d]>0&&Date.now()-b.ultimoCache[d]>b.cacheTimeout[d])c[d]=null;else if(c[d])return l.resolve(c[d]);var e=this;return k({method:this._method,url:this._url,headers:n,data:this._data||{}}).then(function(f){return f=a(f,b.dataPath),e._cache&&(b.ultimoCache[d]=Date.now(),c[d]=f),f})},p.clearBuild=function(){return this._build=!1,this},h(p,"cache","_cache",!0),h(p,"clearCache","_clearCache",!0),h(p,"path","_path"),h(p,"method","_method"),h(p,"data","_data"),h(p,"apply","_apply"),h(p,"id","_id",!0),f(p,"tipo","POST","/tipo"),f(p,"get","POST","/buscar"),f(p,"post","POST"),f(p,"put","PUT"),f(p,"delete","DELETE"),g(p,"tipoIn","tipo"),g(p,"getIn","get"),g(p,"postIn","post"),g(p,"putIn","put"),g(p,"deleteIn","delete");var q=i.prototype;q.clearBuild=p.clearBuild,q.apply=p.apply,q.id=p.id,q.path=p.path,q.method=p.method,q.add=function(a){return this._querys.push(a),this},q.remove=function(a){for(var b=0;b<this._querys.length;b++)if(this._querys[b]===a){this._querys.splice(b,1);break}return this},q.build=function(){for(var a=0;a<this._querys.length;a++)this._querys[a].build();return this._build=!0,this},q.send=function(){},f(q,"get","POST","/buscar"),f(q,"put","PUT"),f(q,"post","POST"),f(q,"delete","DELETE"),g(q,"tipoIn","tipo"),g(q,"getIn","get"),g(q,"putIn","put"),g(q,"postIn","post"),g(q,"deleteIn","delete"),b.provider("Entidades",[function(){this.defaults=m,this.$get=["context",function(a){var b=this,c={query:function(a){return"string"==typeof a&&(a=c.entidade(a)),new e(a)},muitosQuery:function(a){return a?void 0:new i},entidade:function(c,e,f){var g=o[c];return g&&!f?g:(e||(e={}),e.url||(e.url=a.services+m.url),g=new d(c,e),b[c]=o[c]=g,g)},get:function(a){return o[a]}};return c.eq=c.equal="=",c.ne=c.notEqual="!=",c.le=c.lowerThanOrEqualTo="<=",c.ge=c.greaterThanOrEqualTo=">=",c.lt=c.lowerThan="<",c.gt=c.greaterThan=">",c.nl=c.notLike="notlike",c.lk=c.like="like",c}]}])}(),b.provider("HostInter",[function(){var a=this;a.ativo=!1,a.url="",a.$get=["context",function(b){var c={request:function(c){return a.ativo&&(c.url=a.url+b.services+c.url),c}};return c}]}]),b.provider("LoginInter",["state",function(a){var b=this;b.handler=null,b.state="login",b.url="/login.jsp",b.ativo=!0,b.ERRORCODE_LOGIN=401,b.$get=["context","$window",function(c,d){var e={response:function(e){if(b.ativo&&e.data&&e.data.code===b.ERRORCODE_LOGIN)if(b.handler)b.handler(e);else if(b.state)a.go(b.state);else{var f=d.location.origin;d.location=f+c.services+b.url}return e}};return e}]}]),function(){var a,c,d=angular.injector(["ng"],!0),e=d.get("$q"),f=null,g=e(function(b,d){a=b,c=d});g._recarregar=!1,g.recarregar=function(){return g};var h=g.then;g.then=function(){g.$$state.status||g._recarregar||g.recarregar(),h.apply(g,arguments)},b.provider("Usuario",function(){f=this,this.carregarAoIniciar=!1,this.$get=function(){return g}}),b.run(["context","$http",function(b,d){g.recarregar=function(){return g._recarregar?g:(g.$$state.status=0,g._recarregar=!0,d.get(b.services+"/seguranca/usuario").then(function(b){200===b.data.codigo&&b.data.data?a(b.data.data):c({})},function(a){c(a)})["finally"](function(){g._recarregar=!1}),g)},f.carregarAoIniciar&&g.recarregar()}])}(),b.provider("context",[function(){function a(a,c,d){if(!a)return"";if("string"!=typeof a)throw"To configure the context url string you must pass a string as the first parameter value.";return"undefined"==typeof c&&(c=!0),a=a.trim(),c?0!==a.indexOf("/")&&(a="/"+a):0===a.indexOf("/")&&(a=a.substring(1,a.length)),d?a.lastIndexOf("/")!==a.length-1&&(a+="/"):a.lastIndexOf("/")===a.length-1&&(a=a.substring(0,a.length-1)),b(a)}function b(a){return a.replace(/\/\/+/g,"/")}var c=this,d={root:function(){return c.context.root=a.apply(this,arguments),c.context.services=b(c.context.root+c.context.path.services),c.context.websocket=b(c.context.root+c.context.path.websocket),c},services:function(){return c.context.services=b(c.context.root+(c.context.path.services=a.apply(this,arguments))),c},websocket:function(){return c.context.websocket=b(c.context.root+(c.context.path.websocket=a.apply(this,arguments))),c},put:function(b){return c.context[b]=a.call(this,arguments[1],arguments[2],arguments[3]),c},context:{root:"",path:{}}};angular.extend(this,d),this.$get=[function(){return c.context}]}])}(window);