!function(a){var b=angular.module("JavaModelo",["ng"]);b.config(["$httpProvider",function(a){a.interceptors.push("LoginInter"),a.interceptors.push("HostInter"),a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),function(){var a,c,d=angular.injector(["ng"],!0),e=d.get("$q"),f=e(function(b,d){a=b,c=d});f.reload=function(){return f},b.value("Usuario",f),b.run(["context","$http",function(b,d){f.reload=function(){return f.$$state.status=0,d.get(b.services+"/seguranca/usuario").then(function(b){200===b.data.codigo&&b.data.data?a(b.data.data):c({})},function(a){c(a)}),f},f.reload()}])}(),b.directive("segGrupo",[function(){return{link:function(b,c,d){var e=a.Usuario;if(e&&e.credencial&&e.credencial.grupos){var f={};for(var g in e.credencial.grupos){var h=e.credencial.grupos[g],i=h.chave.trim();f[i]||(f[i]=h)}var j=d.segGrupo.trim();0===j.indexOf("!")?f[j.substring(1,j.length)]&&c.remove():f[j]||c.remove()}}}}]),b.directive("segPermissao",[function(){return{link:function(b,c,d){var e=a.Usuario;if(e&&e.credencial&&e.credencial.grupos){var f={};for(var g in e.credencial.grupos){var h=e.credencial.grupos[g];if(h.permissoes)for(var i in h.permissoes){var j=h.permissoes[i],k=j.nome.trim();f[k]||(f[k]=j)}}for(var i in e.credencial.permissoes){var j=e.credencial.permissoes[i],k=j.nome.trim();f[k]||(f[k]=j)}var l=d.segPermissao.trim();0===l.indexOf("!")?f[l.substring(1,l.length)]&&c.remove():f[l]||c.remove()}}}}]),function(){function a(a,b){if(!b)return a;"string"==typeof b&&(b=b.split("."));for(var c=0;c<b.length;c++)a=a[b[c]]||(a[b[c]]={});return a}function c(a,b){a.$scope&&!a.$scope.$$phase?a.$scope.$apply():b&&b.$apply&&!b.$$phase&&b.$apply()}function d(a,b){b||(b={}),this.nome=a,this.dataPath=b.dataPath||l.dataPath,this.size=b.size||l.size,this.page=b.page||l.page,this.url=b.url||l.url}function e(a){this.entidade=a instanceof Array?a[0]:a||{},this._size=this.entidade.size,this._page=this.entidade.page,this._param=[],this._join=[],this._order=[],this._data=null,this._url=this.entidade.url,this._method="",this.$scope=null,this._build=!1,this._path="",this._buscarUm=!0,this._buscarMuitos=!1,this._buscarId=!1}function f(a,b,c,d){a[b]=function(a){return this.path(d).data(a).method(c).build().send()}}function g(b,d,e){b[d]=function(b,d,f){d||(d=this.entidade.nome),d=d.split(".");var g=a(b,d.slice(0,d.length-1));d=d[d.length-1];var h=this;return this[e](f).then(function(a){return g[d]=a,c(h,b),a})}}function h(){this._querys=[],this._method="",this.$scope=null,this._build=!1,this._path="",this._buscarId=!1}var i=angular.injector(["ng"],!0),j=i.get("$http"),k=i.get("$q"),l={contentType:"application/json",dataPath:"data.data",size:20,page:0,url:"/persistencia"},m={"Content-Type":l.contentType},n={},o={},p=e.prototype;p.size=function(a){return"number"==typeof a&&(this._size=a),this},p.page=function(a){return"number"==typeof a&&(this._page=a),this},p.order=function(a){if(a instanceof Array)for(var b in a){var c=a[b];"string"==typeof c&&this._order.push(c)}else"string"==typeof a&&this._order.push(a);return this},p.join=function(a){if(a instanceof Array)for(var b in a){var c=a[b];"string"==typeof c&&this._join.push(c)}else"string"==typeof a&&this._join.push(a);return this},p.param=function(a,b,c,d,e){return a?(d?"&"!==d&&"|"!==d&&(d="|"):d="&",void 0===e?(c=""+c,0!==c.indexOf('"')&&0!==c.indexOf("'")&&(c='"'+c),c.lastIndexOf('"')!==c.length-1&&c.lastIndexOf("'")!==c.length-1&&(c+='"')):e&&(c='"'+c+'"'),this._param.push(a+" "+b+" "+c+d),this):null},p.build=function(a){if(this._build&&!a)return this;var b="";for(var c in this._param)b+=this._param[c];b=b.replace(/[&\|\s]+$/,""),b&&(b="?"+b);var d=["size="+this._size,"page="+this._page];this._join.length>0&&d.push("join="+this._join.join(",")),this._order.length>0&&d.push("order="+this._order.join(",")),d=d.join(";"),d&&(d=";"+d),this._path||(this._path="");var e=""+(this._buscarUm?"/um":this._buscarMuitos?"/muitos":"")+(this._buscarId?"/id":"");return e=this._url+e+(this._buscarMuitos?"":"/"+this.entidade.nome)+this._path,this._url=e+d+b,this._build=!0,this},p.send=function(){var b=this;return j({method:this._method,url:this._url,headers:m,data:this._data||{}}).then(function(c){return a(c,b.entidade.dataPath)})},p.clearBuild=function(){return this._build=!1,this},p.apply=function(a){return this.$scope=a,this},p.data=function(a){return this._data=a,this},p.method=function(a){return this._method=a,this},p.path=function(a){return this._path=a,this},p.id=function(a){"undefined"==typeof a&&(a=!0),this._id=a},p.tipo=function(a){var b=this,c=n[b.entidade.nome];return!c||a?b.path("/tipo").method("POST").build().send().then(function(a){return n[b.entidade.nome]=a}):k.resolve(c)},f(p,"get","POST","/buscar"),f(p,"put","PUT"),f(p,"post","POST"),f(p,"delete","DELETE"),g(p,"tipoIn","tipo"),g(p,"getIn","get"),g(p,"putIn","put"),g(p,"postIn","post"),g(p,"deleteIn","delete");var q=h.prototype;q.clearBuild=p.clearBuild,q.apply=p.apply,q.id=p.id,q.path=p.path,q.method=p.method,q.add=function(a){return this._querys.push(a),this},q.remove=function(a){for(var b=0;b<this._querys.length;b++)if(this._querys[b]===a){this._querys.splice(b,1);break}return this},q.build=function(){for(var a=0;a<this._querys.length;a++)this._querys[a].build();return this._build=!0,this},q.send=function(){},f(q,"get","POST","/buscar"),f(q,"put","PUT"),f(q,"post","POST"),f(q,"delete","DELETE"),g(q,"tipoIn","tipo"),g(q,"getIn","get"),g(q,"putIn","put"),g(q,"postIn","post"),g(q,"deleteIn","delete"),b.provider("Entidades",[function(){this.defaults=l,this.$get=["context",function(a){var b=this,c={query:function(a){a instanceof Array||(a=[a]);for(var b=0;b<a.length;b++){var c=a[b];"string"==typeof c&&(a[b]=o[c])}return new e(a)},muitosQuery:function(a){return a?void 0:new h},entidade:function(c,e,f){var g=o[c];return g&&!f?g:(e||(e={}),e.url||(e.url=a.services+l.url),g=new d(c,e),b[c]=o[c]=g,g)},get:function(a){return o[a]}};return c.eq=c.equal="=",c.ne=c.notEqual="!=",c.le=c.lowerThanOrEqualTo="<=",c.ge=c.greaterThanOrEqualTo=">=",c.lt=c.lowerThan="<",c.gt=c.greaterThan=">",c.nl=c.notLike="notlike",c.lk=c.like="like",c}]}])}(),b.provider("HostInter",[function(){var a=this;a.ativo=!1,a.url="",a.$get=["context",function(b){var c={request:function(c){return a.ativo&&(c.url=a.url+b.services+c.url),c}};return c}]}]),b.provider("LoginInter",[function(){var a=this;a.url="/login.jsp",a.ativo=!0,a.ERRORCODE_LOGIN=401,a.$get=["context","$window",function(b,c){var d={response:function(d){if(a.ativo&&d.data&&d.data.code===a.ERRORCODE_LOGIN){var e=c.location.origin;c.location=e+b.services+a.url}return d}};return d}]}]),b.provider("context",[function(){function a(a,c,d){if(!a)return"";if("string"!=typeof a)throw"To configure the context url string you must pass a string as the first parameter value.";return"undefined"==typeof c&&(c=!0),a=a.trim(),c?0!==a.indexOf("/")&&(a="/"+a):0===a.indexOf("/")&&(a=a.substring(1,a.length)),d?a.lastIndexOf("/")!==a.length-1&&(a+="/"):a.lastIndexOf("/")===a.length-1&&(a=a.substring(0,a.length-1)),b(a)}function b(a){return a.replace(/\/\/+/g,"/")}var c=this,d={root:function(){return c.context.root=a.apply(this,arguments),c.context.services=b(c.context.root+c.context.path.services),c.context.websocket=b(c.context.root+c.context.path.websocket),c},services:function(){return c.context.services=b(c.context.root+(c.context.path.services=a.apply(this,arguments))),c},websocket:function(){return c.context.websocket=b(c.context.root+(c.context.path.websocket=a.apply(this,arguments))),c},put:function(b){return c.context[b]=a.call(this,arguments[1],arguments[2],arguments[3]),c},context:{root:"",path:{}}};angular.extend(this,d),this.$get=[function(){return c.context}]}])}(window);